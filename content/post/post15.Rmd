---
title: 【日次GDP】Google Earth Engine APIで衛星画像データを取得し、景況感をナウキャスティングしてみる（第２回）
author: Ayato Ashiara
date: '2019-08-15'
slug: post15
categories:
  - 日次GDP
tags:
  - Earth Engine
  - Python
  - 時系列解析
image: img/portfolio/earthengine6.jpg
---

<!--more-->

```{r,include=FALSE}

library(reticulate)
conda_path <- "C:\\Users\\aashi\\Anaconda3"
use_condaenv(conda_path)

```

おはこんばんにちは。前回の記事でGoogl Earth Enngineから衛星画像データを取得しました。今回はそのデータを用いて景況感のナウキャスティングをやってみます。
まず、前回取得したデータを見ましょう。

```{python, include=FALSE}
import pandas as pd

nightjp_csv = pd.read_csv('C:/Users/aashi/Desktop/my_blog/public/dataset/jpnightlight.csv')

```

```{python}
import pandas as pd
import matplotlib.pyplot as plt
import os

os.environ['QT_QPA_PLATFORM_PLUGIN_PATH'] = 'C:/Users/aashi/Anaconda3/Library/plugins/platforms'

plt.style.use('ggplot')

nightjp = nightjp_csv.assign(date=lambda nightjp_csv:pd.to_datetime(nightjp_csv['system:index']))
nightjp.head()

plt.plot(nightjp['date'],nightjp['sum'])

```

かなり季節性があることがわかります。どうやら冬場に光量が大きくなる傾向になるようです。なので、季節調整をかけてみます。RではX-13ARIMA-SEATSをいつも使用していますが、rmarkdownからのpythonでの使い方がわからないので、statsmodels.apiのseasonal_decomposeを使います。冬場とそれ以外で挙動が異なるのでfreqは12にしてみました。

```{python}
import statsmodels.api as sm
nightjp = nightjp.set_index('date')
nightjp_sm = sm.tsa.seasonal_decompose(nightjp['sum'],freq=12,model='multiplicative')
nightjp_sm.plot()

```

季節性を除いたTrendが2016年半ばくらいから2017年下旬にかけて急激に上昇しています。おそらく、景況感とはあまり相関がなさそうな動きをしていますが、以下の記事を参考にestatからAPIで鉱工業生産指数のデータを落とし、検証してみます。

http://sinhrks.hatenablog.com/entry/2015/12/31/222207

```{python,include=FALSE}

key = '16aba745ce9d2640a24adcd96c0b39e60c181de4'

```

```{python}
import numpy as np
import japandas as jpd
import datetime 

dlist = jpd.DataReader("00550300", 'estat', appid=key)
tables = dlist[(dlist['統計表題名及び表番号'].str.contains('付加価値額生産')) & (dlist['提供統計名及び提供分類名'].str.contains('鉱工業生産・出荷・在庫指数'))]
data = jpd.DataReader("0003325360", 'estat', appid=key)
df = data[(data['業種別'].str.contains('1000000000 鉱工業')) & ~(data['統計項目A'].str.contains('付加生産ウエイト'))]
df = df.set_index(pd.to_datetime(df["統計項目A"], format="%Y%m"))
df.head()

```


